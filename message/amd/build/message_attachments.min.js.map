{"version":3,"file":"message_attachments.min.js","sources":["../src/message_attachments.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Controls the message popover in the nav bar.\n *\n * @module     core_message/message_attachments\n * @copyright  Moodle India <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n    [\n        'jquery',\n        'core/str'\n    ],\n    function (\n        $,\n        Str\n    ) {\n        var init = function () {\n            document.getElementById('photosvideos').addEventListener('click', openDialog);\n            document.getElementById('document').addEventListener('click', openDialogDoc);\n            function openDialog() {\n                document.getElementById('msgattachments').click();\n                $('#errormsg').text('');\n            }\n            function openDialogDoc() {\n                document.getElementById('msgdocuments').click();\n                $('#errormsg').text('');\n            }\n            $(\"#msgattachments\").change(function () {\n                $('#mainmediadropdownmenu').removeClass('show');\n                $('#mediadropdownmenu').removeClass('show');\n                readURL(this);\n            });\n            $(\"#msgdocuments\").change(function () {\n                $('#mainmediadropdownmenu').removeClass('show');\n                $('#mediadropdownmenu').removeClass('show');\n                readURL(this);\n            });\n            function readURL(input) {\n                $('[data-region=\"confirm-dialogue-container\"]').removeClass('hidden');\n                if (input.files && input.files[0]) {\n                    console.log(input.files[0]);\n                    var type;\n                    var filetype = input.files[0].type;\n                    if(filetype.indexOf(\"image\") !== -1){\n                        type = 'image.png'\n                    }else if(filetype.indexOf(\"video\") !== -1){\n                        type = 'video.png'\n                    }else{\n                        type = 'document.png'\n                    }\n                    return Str.get_strings([\n                        {\n                            key: 'confirmation',\n                            component: 'core_message',\n                            param: null\n                        },\n                        {\n                            key: 'title',\n                            component: 'core_message',\n                            param: input.files[0].name\n                        },\n                        {\n                            key: 'filetype',\n                            component: 'core_message',\n                            param: input.files[0].type\n                        }\n                    ])\n                        .then(function (strings) {\n                            var fileype = strings[2];\n                            var title = strings[1];\n                            var heading = strings[0];\n                            $('[data-region=\"dialogue-text\"]').html(heading);\n                            var reader = new FileReader();\n                            $('[data-region=\"title-text\"]').html(title);\n                            var imgurl = $('#pictureurl').val();\n                            $('#attachmentpreview').attr('src', imgurl+type);\n                            $('#attachmentpreview').show();\n                            reader.readAsDataURL(input.files[0]);\n                        });\n                }\n            }\n            $('[data-action=\"okay-confirm\"]').click(function () {\n                attachmentpreview();\n                $('[data-region=\"title-text\"]').html('');\n                $('[data-region=\"type-text\"]').html('');\n                $('[data-action=\"send-message\"]').trigger('click');\n                $('#attachmentpreview').hide();\n                $('#attachmentpreview').attr('src', '');\n            });\n            $('[data-action=\"cancel-confirm\"]').click(function () {\n                attachmentpreview();\n                $(\"#msgattachments\").val('');\n                $(\"#msgdocuments\").val('');\n                $('#attachmentpreview').hide();\n                $('#attachmentpreview').attr('src', '');\n            });\n            function attachmentpreview() {\n                $('[data-region=\"confirm-dialogue-container\"]').addClass('hidden');\n                $('#attachmentpreview').addClass('hidden');\n            }\n            $('[data-region=\"send-message-txt\"]').keypress(function () {\n                $('#errormsg').text('');\n            });\n        };\n        return {\n            init: init,\n        };\n    });\n"],"names":["define","$","Str","init","readURL","input","removeClass","files","type","console","log","filetype","indexOf","get_strings","key","component","param","name","then","strings","title","heading","html","reader","FileReader","imgurl","val","attr","show","readAsDataURL","attachmentpreview","addClass","document","getElementById","addEventListener","click","text","change","this","trigger","hide","keypress"],"mappings":";;;;;;;AAsBAA,0CACI,CACI,SACA,aAEJ,SACIC,EACAC,WA0FO,CACHC,KAzFO,oBAqBEC,QAAQC,UACbJ,EAAE,8CAA8CK,YAAY,UACxDD,MAAME,OAASF,MAAME,MAAM,GAAI,KAE3BC,KADJC,QAAQC,IAAIL,MAAME,MAAM,QAEpBI,SAAWN,MAAME,MAAM,GAAGC,YAE1BA,MAD8B,IAA/BG,SAASC,QAAQ,SACT,aAC6B,IAA/BD,SAASC,QAAQ,SACf,YAEA,eAEJV,IAAIW,YAAY,CACnB,CACIC,IAAK,eACLC,UAAW,eACXC,MAAO,MAEX,CACIF,IAAK,QACLC,UAAW,eACXC,MAAOX,MAAME,MAAM,GAAGU,MAE1B,CACIH,IAAK,WACLC,UAAW,eACXC,MAAOX,MAAME,MAAM,GAAGC,QAGzBU,MAAK,SAAUC,SACEA,QAAQ,OAClBC,MAAQD,QAAQ,GAChBE,QAAUF,QAAQ,GACtBlB,EAAE,iCAAiCqB,KAAKD,aACpCE,OAAS,IAAIC,WACjBvB,EAAE,8BAA8BqB,KAAKF,WACjCK,OAASxB,EAAE,eAAeyB,MAC9BzB,EAAE,sBAAsB0B,KAAK,MAAOF,OAAOjB,MAC3CP,EAAE,sBAAsB2B,OACxBL,OAAOM,cAAcxB,MAAME,MAAM,iBAmBxCuB,oBACL7B,EAAE,8CAA8C8B,SAAS,UACzD9B,EAAE,sBAAsB8B,SAAS,UAjFrCC,SAASC,eAAe,gBAAgBC,iBAAiB,oBAGrDF,SAASC,eAAe,kBAAkBE,QAC1ClC,EAAE,aAAamC,KAAK,OAHxBJ,SAASC,eAAe,YAAYC,iBAAiB,oBAMjDF,SAASC,eAAe,gBAAgBE,QACxClC,EAAE,aAAamC,KAAK,OAExBnC,EAAE,mBAAmBoC,QAAO,WACxBpC,EAAE,0BAA0BK,YAAY,QACxCL,EAAE,sBAAsBK,YAAY,QACpCF,QAAQkC,SAEZrC,EAAE,iBAAiBoC,QAAO,WACtBpC,EAAE,0BAA0BK,YAAY,QACxCL,EAAE,sBAAsBK,YAAY,QACpCF,QAAQkC,SA8CZrC,EAAE,gCAAgCkC,OAAM,WACpCL,oBACA7B,EAAE,8BAA8BqB,KAAK,IACrCrB,EAAE,6BAA6BqB,KAAK,IACpCrB,EAAE,gCAAgCsC,QAAQ,SAC1CtC,EAAE,sBAAsBuC,OACxBvC,EAAE,sBAAsB0B,KAAK,MAAO,OAExC1B,EAAE,kCAAkCkC,OAAM,WACtCL,oBACA7B,EAAE,mBAAmByB,IAAI,IACzBzB,EAAE,iBAAiByB,IAAI,IACvBzB,EAAE,sBAAsBuC,OACxBvC,EAAE,sBAAsB0B,KAAK,MAAO,OAMxC1B,EAAE,oCAAoCwC,UAAS,WAC3CxC,EAAE,aAAamC,KAAK"}