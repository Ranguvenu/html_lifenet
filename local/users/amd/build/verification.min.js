/**
 * mobile number verification.
 *
 * @module     local_users/verification
 * @copyright  Dipanshu Kasera <kasera.dipanshu@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_users/verification",["jquery","core/ajax","core/str","core/notification"],(function($,Ajax,Str,Notification){Str.get_strings([{key:"success:successfullysentotp",component:"local_users"},{key:"success:successfullyresentotp",component:"local_users"},{key:"error:otpexpired",component:"local_users"},{key:"error:phone1",component:"local_users"},{key:"error:country",component:"local_users"},{key:"error:somethingwentwrong",component:"local_users"},{key:"error:lockedusers",component:"local_users"},{key:"error:lockedsms",component:"local_users"},{key:"error:code",component:"local_users"}]).then((function(s){function sendotp(phone1,country,otpcode,flag){if(""==phone1||""==country&&0==country)""==phone1||0==country?$("#id_error_country").html(s[3]).show():$("#id_error_country").hide();else{var params={};params.phone1=phone1,params.country=country,params.otpcode=otpcode,params.flag=flag,Ajax.call([{methodname:"local_users_validateuserdetails",args:params}])[0].done((function(res){if(1==res.res)1==flag?$("#id_error_country").html(s[0]):2==flag&&$("#id_error_country").html(s[1]),$(".signup_form").hide(),$("#id_sentotplink").hide(),$("#id_error_country").hide(),$("#loginpassdiv").show(),$("#id_country").prop("disabled",!0),$("#id_phone1").prop("disabled",!0),$("#id_error_country").show(),$("#id_error_country").css("color","green");else if(3==res.res){Str.get_string("error:lockoutnotification","local_users",res.id).then((data=>{$("#id_error_otpcode").html(data).show()})),0==res.id&&($("#id_validateotp").hide(),$("#resendotplink").hide(),Notification.addNotification({type:"error",message:s[6]}))}else 4==res.res?$("#id_error_otpcode").html(s[2]).show():5==res.res?window.location.href=M.cfg.wwwroot+"/local/users/confirm.php?r=0":6==res.res?($("#loginpassdiv").hide(),Notification.addNotification({type:"error",message:s[7]}),$("#id_sentotplink").hide(),$("#id_country").prop("disabled",!0),$("#id_phone1").prop("disabled",!0)):window.location.href=M.cfg.wwwroot+"/local/users/registration.php?status=1&vid="+res.id})).fail((function(){}))}}$("#id_sentotplink").on("click",(function(){var phone1=$("#id_phone1").val(),country=$("#id_country").val();""==phone1||0==country?$("#id_error_country").html(s[3]).show():($("#id_error_country").hide(),sendotp(phone1,country,0,1));var duration=$('input[name="duration"]').val();setTimeout((function(){$("#resendotplink").show()}),1e3*duration),$("#resendotplink").hide()})),$("#resendotplink").on("click",(function(){var phone1=$("#id_phone1").val(),country=$("#id_country").val();""==phone1||0==country?$("#id_error_country").html(s[3]).show():($("#id_error_country").hide(),sendotp(phone1,country,0,2)),$("#id_error_otpcode").hide();var sec=1e3*$('input[name="duration"]').val();$("#resendotplink").hide(),setTimeout((function(){$("#resendotplink").show()}),sec)})),$("#id_validateotp").on("click",(function(){var phone1=$("#id_phone1").val(),country=$("#id_country").val(),otpcode=$("#id_otpcode").val();""==otpcode?$("#id_error_otpcode").html(s[8]).show():(sendotp(phone1,country,otpcode,3),$("#id_error_otpcode").hide()),$("#id_error_country").hide()}))}))}));

//# sourceMappingURL=verification.min.js.map