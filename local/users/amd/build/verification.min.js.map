{"version":3,"file":"verification.min.js","sources":["../src/verification.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * mobile number verification.\n *\n * @module     local_users/verification\n * @copyright  Dipanshu Kasera <kasera.dipanshu@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/str', 'core/notification'], function($, Ajax, Str, Notification) {\n\n    Str.get_strings([\n        {\n            key: 'success:successfullysentotp',\n            component: 'local_users'\n        },\n        {\n            key: 'success:successfullyresentotp',\n            component: 'local_users'\n        },\n        {\n            key: 'error:otpexpired',\n            component: 'local_users'\n        },\n        {\n            key: 'error:phone1',\n            component: 'local_users'\n        },\n        {\n            key: 'error:country',\n            component: 'local_users'\n        },\n        {\n            key: 'error:somethingwentwrong',\n            component: 'local_users'\n        },\n        {\n            key: 'error:lockedusers',\n            component: 'local_users'\n        },\n        {\n            key: 'error:lockedsms',\n            component: 'local_users'\n        }\n        ,\n        {\n            key: 'error:code',\n            component: 'local_users'\n        }\n    ]).then(function(s) {\n\n        $(\"#id_sentotplink\").on('click', function() {\n            var phone1 = $(\"#id_phone1\").val();\n            var country = $(\"#id_country\").val();\n            var flag = 1;\n            var otpcode = 0;\n\n            if (phone1 == '' || country == 0) {\n                $('#id_error_country').html(s[3]).show();\n            } else {\n                $('#id_error_country').hide();\n                sendotp(phone1, country, otpcode, flag);\n            }\n\n            var duration = $('input[name=\"duration\"]').val();\n            var sec = duration * 1000;\n\n            setTimeout(function() {\n                $(\"#resendotplink\").show();\n            }, sec);\n            $(\"#resendotplink\").hide();\n        });\n\n        $(\"#resendotplink\").on('click', function() {\n            var phone1 = $(\"#id_phone1\").val();\n            var country = $(\"#id_country\").val();\n            var flag = 2;\n            var otpcode = 0;\n\n            if (phone1 == '' || country == 0) {\n                $('#id_error_country').html(s[3]).show();\n            } else {\n                $('#id_error_country').hide();\n                sendotp(phone1, country, otpcode, flag);\n            }\n\n            $('#id_error_otpcode').hide();\n\n            var duration = $('input[name=\"duration\"]').val();\n            var sec = duration * 1000;\n\n            $(\"#resendotplink\").hide();\n            setTimeout(function() {\n                $(\"#resendotplink\").show();\n            }, sec);\n        });\n\n        $(\"#id_validateotp\").on('click', function() {\n            var phone1 = $(\"#id_phone1\").val();\n            var country = $(\"#id_country\").val();\n            var otpcode = $(\"#id_otpcode\").val();\n            var flag = 3;\n            if (otpcode == '') {\n                $('#id_error_otpcode').html(s[8]).show();\n            } else {\n                sendotp(phone1, country, otpcode, flag);\n                $('#id_error_otpcode').hide();\n            }\n            $('#id_error_country').hide();\n        });\n\n        /**\n         * sendotp user\n         *\n         * @param {object} phone1\n         * @param {object} country\n         * @param {object} otpcode\n         * @param {object} flag\n         */\n        function sendotp(phone1, country, otpcode, flag) {\n            if (phone1 != '' && (country != '' || country != 0)) {\n                var params = {};\n                params.phone1 = phone1;\n                params.country = country;\n                params.otpcode = otpcode;\n                params.flag = flag;\n                var promise = Ajax.call([{\n                    methodname: 'local_users_validateuserdetails',\n                    args: params\n                }]);\n                promise[0].done(function(res) {\n                    if (res.res == 1) {\n                        if (flag == 1) {\n                            $('#id_error_country').html(s[0]);\n                        } else if (flag == 2) {\n                            $('#id_error_country').html(s[1]);\n                        }\n\n                        $(\".signup_form\").hide();\n                        $(\"#id_sentotplink\").hide();\n                        $(\"#id_error_country\").hide();\n                        $(\"#loginpassdiv\").show();\n\n                        $(\"#id_country\").prop('disabled', true);\n                        $(\"#id_phone1\").prop('disabled', true);\n                        $('#id_error_country').show();\n                        $('#id_error_country').css('color', 'green');\n                    } else if (res.res == 3) {\n                        var str = Str.get_string('error:lockoutnotification', 'local_users', res.id);\n                        str.then(data => {\n                            $('#id_error_otpcode').html(data).show();\n                        });\n                        if (res.id == 0) {\n                            $('#id_validateotp').hide();\n                            $('#resendotplink').hide();\n                            Notification.addNotification({\n                                type: 'error',\n                                message: s[6],\n                            });\n                        }\n                    } else if (res.res == 4) {\n                        $('#id_error_otpcode').html(s[2]).show();\n                    } else if (res.res == 5) {\n                        window.location.href = M.cfg.wwwroot + '/local/users/confirm.php?r=0';\n                    }  else if (res.res == 6) {\n                        $('#loginpassdiv').hide();\n                        Notification.addNotification({\n                            type: 'error',\n                            message: s[7],\n                        });\n                        $(\"#id_sentotplink\").hide();\n                        $(\"#id_country\").prop('disabled', true);\n                        $(\"#id_phone1\").prop('disabled', true);\n                    } else {\n                        window.location.href = M.cfg.wwwroot + '/local/users/registration.php?status=1&vid='+res.id;\n                    }\n                }).fail(function() {\n                    // do something with the exception\n                });\n            } else {\n                if (phone1 == '' || country == 0) {\n                    $('#id_error_country').html(s[3]).show();\n                } else {\n                    $('#id_error_country').hide();\n                }\n            }\n        }\n    });\n});\n"],"names":["define","$","Ajax","Str","Notification","get_strings","key","component","then","s","sendotp","phone1","country","otpcode","flag","html","show","hide","params","call","methodname","args","done","res","prop","css","get_string","id","data","addNotification","type","message","window","location","href","M","cfg","wwwroot","fail","on","val","duration","setTimeout","sec"],"mappings":"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"}